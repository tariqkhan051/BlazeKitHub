@using System.ComponentModel.DataAnnotations
@using System.Text.Json;

<div>
    <EditForm Model="_form" OnValidSubmit="SubmitForm" Context="context">
        <DataAnnotationsValidator />

        <div class="form-row">
            <div class="form-group col-5">
                <label>Carrier Name</label>
                <InputText class="form-control" placeholder="DPD HU" @bind-Value="_form.Name" />
                <ValidationMessage For="@(() => _form.Name)" />
            </div>

            <div class="form-group col-4">
                <label>Integration Name</label>
                <InputText class="form-control" placeholder="dpd-hungary" @bind-Value="_form.IntegrationName" />
                <ValidationMessage For="@(() => _form.IntegrationName)" />
            </div>

            <div class="form-group col-3">
                <label>Country of origin</label>
                <InputText class="form-control" placeholder="HU" @bind-Value="_form.OriginCountry" />
                <ValidationMessage For="@(() => _form.OriginCountry)" />
            </div>
        </div>             

        <div class="form-row">
            <div class="form-group col-6">
                <label>Dev environment username</label>
                <InputText class="form-control" placeholder="774a7558-b511-4e8a-8f0e-99417ebc3658+HU@test.com" @bind-Value="_form.DevUsername" />
                <ValidationMessage For="@(() => _form.DevUsername)" />
            </div>
             
            <div class="form-group col-6">
                <label for="name">Dev environment password</label>
                <InputText class="form-control" placeholder="774a7558-b511-4e8a-8f0e-99417ebc3658" @bind-Value="_form.DevPassword" />
                <ValidationMessage For="@(() => _form.DevPassword)" />
            </div>
        </div>

        <div class="form-row">
            <div class="form-group col-6">
                <label>Staging environment username</label>
                <InputText class="form-control" placeholder="test+HU@auctane.com" @bind-Value="_form.StagingUsername" />
                <ValidationMessage For="@(() => _form.StagingUsername)" />
            </div>

            <div class="form-group col-6">
                <label>Staging environment password</label>
                <InputText class="form-control" placeholder="testpass" @bind-Value="_form.StagingPassword" />
                <ValidationMessage For="@(() => _form.StagingPassword)" />
            </div>
        </div>

        <div class="modal-footer">
            <button id="register-submit" class="btn btn-success" type="submit" disabled="@(!context.IsModified() || !context.Validate())" @onclick="SubmitForm">Add Credentials</button>
        </div>
    </EditForm>
</div>

@code {
    private readonly CreateSECredentialsForm _form = new();
    private EditContext context;
    [CascadingParameter] BlazoredModalInstance BlazoredModal { get; set; } = default!;

    protected override void OnInitialized() => BlazoredModal.SetTitle("New SE Credentials");

    private async Task SubmitForm()
    {
        await BlazoredModal.CloseAsync(ModalResult.Ok(_form));
    }

    public class CreateSECredentialsForm
    {
        [Required(ErrorMessage = "Please provide an origin country.")]
        public string? OriginCountry { get; set; }

        [Required(ErrorMessage = "Please provide integration name.")]
        public string? IntegrationName { get; set; }

        [Required(ErrorMessage = "Please enter carrier name.")]
        public string? Name { get; set; }

        [Required(ErrorMessage = "Please enter username for Dev environment.")]
        public string? DevUsername { get; set; }

        [Required(ErrorMessage = "Please enter password for Dev environment.")]
        public string? DevPassword { get; set; }

        public string? StagingUsername { get; set; }

        public string? StagingPassword { get; set; }
    }
}